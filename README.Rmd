---
title: "README, Applegate *et al* (2015), *Climate Dynamics*"
author: "Patrick Applegate, patrick.applegate@psu.edu"
date: "27 May 2016"
output:
  pdf_document:
    fig_caption: yes
---

# Preamble

This document explains how to reproduce Figures 1-3, plus Electronic Supplementary Materials Figure 1, from Applegate _et al_ (2015, _Climate Dynamics_).  These figures were produced using output from the three-dimensional ice sheet model [SICOPOLIS](http://www.sicopolis.net), development v3.0, as well as a two-dimensional ice sheet model written by Byron Parizek (see references in the paper).  We include the model output in this archive; however, we do *not* provide instructions for running these models here.  

Figure 4 was produced by Robert E. Nicholas using climate model output from the 5th Coupled Model Intercomparison Project (CMIP5; http://cmip-pcmdi.llnl.gov/cmip5/).  Instructions for reproducing this figure appear in the `greenland_amplification_figure_4` folder.  The data needed to reproduce this figure must be downloaded from the CMIP5 archive.  

We made Figure 5 using the vector drawing program Inkscape v0.91 (https://inkscape.org).  We include a `.pdf` version of the figure in this code package.  

# Necessary software

The following pieces of software were used to create Figures 1-3, plus Electronic Supplementary Materials Figure 1: 

* [R](http://www.r-project.org) v3.1.2 -- statistical computing, figure generation
* [RStudio](https://www.rstudio.com) v0.98.1103 -- integrated development environment for R
* [Inkscape](https://inkscape.org) v0.91 -- figure polishing

# Necessary R packages

We used the following user-developed software libraries (packages) to generate our results.  These packages must be installed using the `install.packages()` command in R before running any of our R code.  Some of these packages depend on other packages; by default, R will install these prerequisite packages automatically.  

* `RColorBrewer` v1.1-2
* `signal` v0.7-6

# Contents of this archive

The top-level directories in this archive are

```{r}
list.dirs(full.names = FALSE, recursive = FALSE)
```

* `data`: contains `.csv` files with model output from both SICOPOLIS and the two-dimensional ice sheet model
* `figures`: contains the figure files generated by the R scripts in this archive (see below)
* `tables`: contains `.csv` files with quantities derived from the model output (generated by `diagnose_derived_quantities.R` from the `.csv` files in the `data` directory)

The following R command lists all of the R script files (ending in `.R`) in this archive.  

```{r}
list.files(pattern = glob2rx('*.R'), recursive = TRUE)
```

The key files are

* `diagnose_derived_quantities.R`: extracts key quantities from the model output in the `data` folder, generates tables of these key quantities, and writes them as `.csv` files in the `tables` folder
* `exp_wsse.R`: includes a function, `exp.wsse.R`, that fits a decaying exponential to a set of points with associated uncertainties in the $y$-direction
* `Fig1_EDFig1_script.R`: produces Figure 1 in the main text, plus Figure 1 in the Electronic Supplementary Material; uses `exp_wsse.R`
* `Fig2_script.R`, `Fig3_script.R`: produce Figures 2 and 3 in the main text

The `.csv` files in this archive are

```{r}
list.files(pattern = glob2rx('*.csv'), recursive = TRUE)
```

The files with names that follow the pattern `flowline_*.csv` represent output from Byron Parizek's two-dimensional ice sheet model.  In these files, the first column is time in years.  The other columns represent the simulated ice volume in km$^3$ as a function of the input temperature anomaly (0, 3, 4.5, 6, and 12 K, respectively).  

The files with names that follow the pattern `icevol(t)_dT*_*ka.csv` contain output from SICOPOLIS.  The number after `dT` in the filenames indicates the temperature anomaly (0, 1, 2, 3, 4.5, 6, 9, and 12 K), and the number before `ka` indicates how long the simulations in each file were evaluated (either `100ka`, 10$^5$ years, or `60ka`, 6* 10$^4$ years).  In these files, the first column is time in years.  The other columns represent the simulated ice volume in meters of sea level equivalent for 27 model runs with different input parameter combinations (runs #3, 7, 8, 15, 18, 19, 23, 29, 30, 40, 43, 45, 46, 47, 49, 51, 53, 60, 66, 67, 70, 78, 82, 87, 88, 89, and 92 from Applegate et al., 2012).  

The remaining files, which are all stored in the `tables` directory, give various quantities that were extracted from the SICOPOLIS output files using `diagnose_derived_quantities.R`.  These files are organized with rows indicating temperature anomaly (from top to bottom, 0, 1, 2, 3, 4.5, 6, 9, and 12 K) and columns indicating which model run is being considered (see the last paragraph).  

The particular derived quantities stored in each file, and the corresponding units, are as follows: 

* `deltaV.csv`: equilibrium ice volume change (initial ice volume minus final ice volume), in meters of sea level equivalent
* `tau.csv`: $e$-folding time of ice volume adjustment, in years
* `V_tau.csv`: ice volume when the $e$-folding time is reached, in meters of sea level equivalent

The following files contain figures: 

```{r}
list.files(pattern = glob2rx('*.pdf'), recursive = TRUE)
```

`README.pdf` is this file.  The numbering of the remaining files is consistent with the figure numbers in the final paper (note that `ESM_Fig_1.pdf` is stored on the journal's Web page).  

# Manual modifications to the figure files

Most of the figures were manually modified using Inkscape before publication.  These modifications are *not* reflected by the `.pdf` files in this archive (see the published paper for the final figures).  

* Figure 1: `Fig_1a.pdf` and `Fig_1b.pdf` were combined into a single document.  Annotations were added to the top panel of the combined figure to better show the meaning of the $e$-folding time.  In the lower panel, the string $\Delta T_{grl} =$ was added to show that the different colors indicate groups of runs that use the same temperature anomaly.
* Figure 2: The $y$-axis labels on the top panel were changed to conform with standard ways of displaying information on logarithmic axes.  The gray and pink lines and labels were changed to black.
* Figure 3: The curves and points were labeled according to the forcing temperature anomaly.

## Running our R code

To reproduce our results, first run `diagnose_derived_quantities.R`.  The other scripts can be run in any order.  

To run an R script, first open it in RStudio.  Next, click `Session > Set Working Directory > To Source Location` in the menu at the top of the screen  Finally click the Source button in the upper right-hand corner of the Script window in RStudio.  Remember to install the packages listed above before running these scripts.  